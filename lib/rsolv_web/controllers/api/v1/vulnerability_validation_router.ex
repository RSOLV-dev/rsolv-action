defmodule RsolvWeb.Api.V1.VulnerabilityValidationRouter do
  @moduledoc """
  Router module that selects the appropriate validation controller based on feature flag.
  Allows gradual rollout of the new false positive caching system.
  """
  
  use RsolvWeb, :controller
  
  alias FunWithFlags, as: Flags
  alias RsolvWeb.Api.V1.VulnerabilityValidationController
  alias RsolvWeb.Api.V1.VulnerabilityValidationControllerWithCache
  
  require Logger
  
  def validate(conn, params) do
    # Check if the false positive caching feature is enabled
    case Flags.enabled?(:false_positive_caching) do
      {:ok, true} ->
        Logger.debug("Using cached validation controller")
        VulnerabilityValidationControllerWithCache.validate(conn, params)
        
      _ ->
        Logger.debug("Using standard validation controller")
        VulnerabilityValidationController.validate(conn, params)
    end
  end
end