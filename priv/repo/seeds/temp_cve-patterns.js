
const VulnerabilityType = {
  SQL_INJECTION: 'sql_injection',
  XSS: 'xss',
  COMMAND_INJECTION: 'command_injection',
  PATH_TRAVERSAL: 'path_traversal',
  HARDCODED_SECRET: 'hardcoded_secret',
  WEAK_CRYPTO: 'weak_crypto',
  BROKEN_ACCESS_CONTROL: 'broken_access_control',
  SENSITIVE_DATA_EXPOSURE: 'sensitive_data_exposure',
  XML_EXTERNAL_ENTITIES: 'xxe',
  SECURITY_MISCONFIGURATION: 'security_misconfiguration',
  VULNERABLE_COMPONENTS: 'vulnerable_components',
  BROKEN_AUTHENTICATION: 'broken_authentication',
  INSECURE_DESERIALIZATION: 'insecure_deserialization',
  INSUFFICIENT_LOGGING: 'insufficient_logging',
  UNVALIDATED_REDIRECT: 'open_redirect',
  SSRF: 'ssrf',
  LDAP_INJECTION: 'ldap_injection',
  NOSQL_INJECTION: 'nosql_injection',
  CSRF: 'csrf',
  XXE: 'xxe',
  DESERIALIZATION: 'deserialization',
  RCE: 'rce',
  // Ruby/Rails specific
  MASS_ASSIGNMENT: 'mass_assignment',
  UNSAFE_REFLECTION: 'unsafe_reflection',
  DEBUG_MODE: 'debug_mode',
  WEAK_CRYPTOGRAPHY: 'weak_cryptography',
  // Django specific
  TEMPLATE_INJECTION: 'template_injection',
  ORM_INJECTION: 'orm_injection',
  MIDDLEWARE_BYPASS: 'middleware_bypass'
};
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cveAndOwaspPatterns = void 0;
exports.getCveAndOwaspPatterns = getCveAndOwaspPatterns;
exports.checkForKnownCVEs = checkForKnownCVEs;
const types_js_1 = {};
exports.cveAndOwaspPatterns = [
    {
        id: 'log4shell-detection',
        name: 'Log4Shell Vulnerability (CVE-2021-44228)',
        type: types_js_1.VulnerabilityType.VULNERABLE_COMPONENTS,
        severity: 'critical',
        patterns: {
            regex: [/(log4j.*2\.(0|1[0-6])\.\d|log4j-core.*2\.(0|1[0-6])\.\d)/gi]
        },
        description: 'Detects potentially vulnerable Log4j versions (CVE-2021-44228 - Log4Shell)',
        cweId: 'CWE-502',
        owaspCategory: 'A06:2021 – Vulnerable and Outdated Components',
        languages: ['java', 'kotlin', 'groovy', 'scala', 'xml', 'gradle', 'maven'],
        remediation: 'Update Log4j to version 2.17.0 or later to patch Log4Shell vulnerability',
        examples: {
            vulnerable: 'implementation "org.apache.logging.log4j:log4j-core:2.14.1"',
            secure: 'implementation "org.apache.logging.log4j:log4j-core:2.17.1"'
        }
    },
    {
        id: 'spring4shell-detection',
        name: 'Spring4Shell Vulnerability (CVE-2022-22965)',
        type: types_js_1.VulnerabilityType.VULNERABLE_COMPONENTS,
        severity: 'critical',
        patterns: {
            regex: [/(spring-webmvc|spring-boot-starter-web)[\s\S]*?(5\.[0-2]\.\d{1,2}|5\.3\.([0-9]|1[0-7]))/gi]
        },
        languages: ['java', 'kotlin', 'xml', 'gradle', 'maven'],
        description: 'Detects potentially vulnerable Spring Framework versions (CVE-2022-22965 - Spring4Shell)',
        cweId: 'CWE-94',
        owaspCategory: 'A06:2021 – Vulnerable and Outdated Components',
        remediation: 'Update Spring Framework to 5.3.18+ or 5.2.20+ to patch Spring4Shell vulnerability',
        examples: {
            vulnerable: 'implementation "org.springframework:spring-webmvc:5.3.17"',
            secure: 'implementation "org.springframework:spring-webmvc:5.3.20"'
        }
    },
    {
        id: 'weak-jwt-secret',
        name: 'Weak JWT Secret Detection',
        type: types_js_1.VulnerabilityType.BROKEN_AUTHENTICATION,
        severity: 'high',
        patterns: {
            regex: [/jwt\.sign\([^,]+,\s*["']([^"']{1,16})["']/gi]
        },
        languages: ['javascript', 'typescript'],
        description: 'Detects weak JWT secrets that are too short or predictable',
        cweId: 'CWE-326',
        owaspCategory: 'A07:2021 – Identification and Authentication Failures',
        remediation: 'Use a strong, randomly generated secret of at least 256 bits (32 characters)',
        examples: {
            vulnerable: 'jwt.sign(payload, "secret")',
            secure: 'jwt.sign(payload, crypto.randomBytes(32).toString("hex"))'
        }
    },
    {
        id: 'missing-security-event-logging',
        name: 'Missing Security Event Logging',
        type: types_js_1.VulnerabilityType.INSUFFICIENT_LOGGING,
        severity: 'medium',
        patterns: {
            regex: [/(login|authenticate|authorize|payment|transfer|delete)[\s\S]{0,200}(?!.*\b(log|audit|track|record)\b)/gi]
        },
        languages: [],
        description: 'Detects security-critical operations without proper logging',
        cweId: 'CWE-778',
        owaspCategory: 'A09:2021 – Security Logging and Monitoring Failures',
        remediation: 'Add comprehensive logging for all security-critical operations including authentication, authorization, and sensitive data access',
        examples: {
            vulnerable: 'function login(username, password) { if (checkCredentials(username, password)) return createSession(username); }',
            secure: 'function login(username, password) { const result = checkCredentials(username, password); logger.info("Login attempt", { username, success: result }); return result ? createSession(username) : false; }'
        }
    }
];
function getCveAndOwaspPatterns() {
    return exports.cveAndOwaspPatterns;
}
function checkForKnownCVEs(code) {
    const detectedCVEs = [];
    if (/log4j.*2\.(0|1[0-6])\.\d/gi.test(code)) {
        detectedCVEs.push('CVE-2021-44228 (Log4Shell)');
    }
    if (/(spring-webmvc|spring-boot-starter-web)[\s\S]*?(5\.[0-2]\.\d{1,2}|5\.3\.([0-9]|1[0-7]))/gi.test(code)) {
        detectedCVEs.push('CVE-2022-22965 (Spring4Shell)');
    }
    return detectedCVEs;
}
