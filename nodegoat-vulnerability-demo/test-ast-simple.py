#!/usr/bin/env python3
import requests
import json
import sys

# Test with very simple payload matching what the controller expects
validation_payload = {
    "vulnerabilities": [
        {
            "id": "vuln-001",
            "type": "sql_injection",
            "filePath": "routes/users.js",
            "line": 7,
            "severity": "high"
        }
    ],
    "files": {
        "routes/users.js": {
            "content": """const query = 'SELECT * FROM users WHERE id = ' + userId;"""
        }
    }
}

print("Testing with simple payload...")
print(json.dumps(validation_payload, indent=2))

response = requests.post(
    "https://api.rsolv.dev/api/v1/vulnerabilities/validate",
    headers={
        "X-Api-Key": "rsolv_-1U3PpIl2T3wo3Nw5v9wB1EM-riNnBcloKtq_gveimc",
        "Content-Type": "application/json"
    },
    json=validation_payload
)

print(f"\nStatus: {response.status_code}")
if response.status_code == 200:
    print("Response:", json.dumps(response.json(), indent=2))
else:
    print("Error:", response.text)