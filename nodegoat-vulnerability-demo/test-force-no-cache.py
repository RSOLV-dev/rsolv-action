#!/usr/bin/env python3
import requests
import json

# Force using non-cached controller by setting an env var (won't work via API but let's try)
validation_payload = {
    "vulnerabilities": [
        {
            "id": "vuln-001",
            "type": "sql_injection",
            "filePath": "routes/users.js",
            "line": 7,
            "severity": "high"
        }
    ],
    "files": {
        "routes/users.js": {
            "content": "const query = 'SELECT * FROM users WHERE id = ' + userId;"
        }
    }
}

# Try the old AST endpoint which might not use cache
print("Testing old AST endpoint...")
response = requests.post(
    "https://api.rsolv.dev/ast/validate",
    headers={
        "X-Api-Key": "rsolv_-1U3PpIl2T3wo3Nw5v9wB1EM-riNnBcloKtq_gveimc",
        "Content-Type": "application/json"
    },
    json=validation_payload
)

print(f"Status: {response.status_code}")
if response.status_code == 200:
    print("Response:", json.dumps(response.json(), indent=2))
else:
    print("Error:", response.text)